<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Proactively Lazy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Proactively Lazy">
<meta property="og:url" content="http://flukus.github.io/page/2/index.html">
<meta property="og:site_name" content="Proactively Lazy">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Proactively Lazy">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Proactively Lazy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Proactively Lazy</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://flukus.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2014_07_24_8-Biggest-Mistakes-of-Application-Architecture" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/02/2014_07_24_8-Biggest-Mistakes-of-Application-Architecture/" class="article-date">
  <time datetime="2014-09-01T14:00:00.000Z" itemprop="datePublished">2014-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/02/2014_07_24_8-Biggest-Mistakes-of-Application-Architecture/">8 Biggest mistakes of Application Architecture</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>We spend a lot of time arguing of the minutiae of software development. Exceptions or return codes, dynamic or static typing, OO or functional. IMO these have much less to do with the quality of software produced than the architecture, yet we seem to spend less time discussing that. This is the big picture stuff that makes or breaks a product (and it&#39;s owners) and in my experience, terrible architecture seems to be the norm in the enterprise world.</p>
<p>The following is a bit of a rant about some of the worst anti-patterns I&#39;ve seen in enterprise software. Each one I have experienced at several companies, though (usually) not all at once. Most of them are cargo cult practices, some can be traced back to official Microsoft guidance, some have no reason at all but just seem to exist anyway.</p>
<p>#1. Logical structure != Physical structure</p>
<p>I ran into this one just today. We have two services, a and b, that are different but related yet the share most/all of the same internal libraries. Let&#39;s pretend there are good reasons why these services need to be deployed on different machines, because sometimes there are. This does not mean they need to be in separate .csproj files.</p>
<p>It&#39;s just as easy, perhaps even easier, to deploy a single application to multiple machines with different configurations.</p>
<p>The physical deployment of an application does not have to be a 1:1 mapping with the solution structure.</p>
<p>#2. Development is not Production</p>
<p>On a similar note, it is often claimed that a developers machine should resemble production closely. I can&#39;t think of anything worse. The purpose of a development environment is to DEVELOP, anything that aids this endeavor is welcome, anything that inhibits it is not.</p>
<p>I want to be developing. I don&#39;t care about how many configurations the application will be split into in production. I don&#39;t want to manage IIS application pools. I don&#39;t want to set up SSL certificates. I don&#39;t even want to have to go to the login screen every time I recompile. These are all production issues and you shouldn&#39;t have to deal with it unless your configuring a production environment.</p>
<p>A good rule of thumb here is how long it takes a brand new developer to be setup. The answer should be minutes, not hours or days. I actually (very briefly) worked at a company that considered it normal for new developers to spend a week setting up there environment. Companies like this tend to receive the double blow of a week of downtime and a high turnover rate.</p>
<p>It&#39;s been 15 years since this appeared at number 2 on the <a href="http://www.joelonsoftware.com/articles/fog0000000043.html" target="_blank" rel="external">Joel Test</a>. I&#39;m honestly amazed how many companies still screw it up.</p>
<p>#3. The .csproj Fetish</p>
<p>There are many good reasons to separate code into different projects. An MVC app and a WCF service might share common functionality in a library project (or maybe not, see 1). But there are just as many good reasons NOT to separate code into a million tiny assemblies.</p>
<p>Recently I came across a solution that had 8 projects just to handle pdf conversion. HtmlToPdfConverter, JpegToPdfConverter, etc. Each project had a single class in a single file. The classes combined were barely long to deserve splitting up, let alone into a separate project each.</p>
<p>All this achieves is to slow down build and debug times. MSBuild slows down dramatically as you increase the number of projects. Try feeding your source tree directly into csc and see just how c# code can be compiled.</p>
<p>Long before IDE&#39;s held all our code together things were organized into folders. Fortunately, IDE&#39;s are capable if using this technological wizardry, giving us a very simple mechanism of grouping related functionality. Folders exist, use them!</p>
<p>#4. Repositories on Repositories</p>
<p>ORMs frequently get a bad wrap for generating n+1 queries, but in the world of enterprise architecture I all to often see a different cause: The Repository Pattern.</p>
<p>ORMs actually come with a repository pattern built in. In nHibernate (which I&#39;ll use as my example) the repository is the ISession interface. It&#39;s simple and flexible, it can handle nearly every type of query you need and the ones it can&#39;t should probably not by performed by an ORM anyway.</p>
<p>An architect or developer will come along and build there own repository on top of this one, but with less features and no flexibility. Just in case you want to change your database one day. How many of you have ever actually seen this happen?</p>
<p>The problem with having data access behind a repository is that it has no context of what data is required for the task at hand. Does it need all the children of that entity? Should it load a parent entity? What should it filter by? It ends with a million permutations of a Find method that the ORM repository is perfectly capable of expressing.</p>
<p>Why does this cause n+1 errors? Because it&#39;s abstracted the tool with the best way of resolving them.</p>
<p>Advance Idiots will return a model with lazy loading. Essentially creating an ORM on an ORM.</p>
<p>#5. The Service Layer.</p>
<p>This one only applies to web apps. I&#39;m not talking about a logical service layer here, but a real physical one, usually with WCF as the glue. I think the root cause of this is the same as number 1, architects assuming the the physical structure and the logical structure need to completely match.</p>
<p><a href="http://surana.wordpress.com/2009/01/01/numbers-everyone-should-know/" target="_blank" rel="external">Numbers everyone should know</a> are unfortunately numbers that architects don&#39;t seem to know. Getting data from RAM is a lot faster than getting it from a network. The service is also likely to make network connections of it&#39;s own, usually to a database. The end response time is cumulative, having to make multiple service calls quickly adds up. It won&#39;t even show up in a profiler.</p>
<p>The most frequent justification I hear for this is scalability. Having a service layer on a different machine than the web server will somehow, magically, help the application scale in a way that having multiple web servers (maybe even a farm) will not. If the applications weren&#39;t spending so much time serializing objects and waiting for synchronous remote procedure calls then maybe they would scale a bit more linearly.</p>
<p>The other justification I hear a lot is that service oriented architectures are considered good architecture. I&#39;ll probably save this for another rant, but a service layer and SOA are not synonyms, they are completely unrelated to one another.</p>
<p>Advanced Idiots will combine this with the repository pattern and have n+1 issues spanning multiple network hops.</p>
<p>Super advanced idiots will have services that call services that call services. Displaying a single piece of data to a user can cross a dozen network/process boundaries.</p>
<p>Ultra advanced idiots will instantiate a service layer in it&#39;s own process every time a method needs to be called on it. Seriously, I&#39;ve seen this in a production environment handling millions of dollars a month.</p>
<p>#6. Replacing new with Resolve</p>
<p>This isn&#39;t an attack on IOC containers, I think they&#39;re great, but in the wrong hands they are disastrous. The concept is simple enough, that&#39;s why every man and his dog have created a toy IOC container, unfortunately a lot of people don&#39;t seem to get to the end of tutorial one.</p>
<p>An IOC container is designed to wire up structural dependencies. If a class name ends with Service, Factory or Handler it is a good candidate to go in the container. If the methods of a class contain adjectives then it is a good candidate to go in the container. If a class name ends with Model, DTO, Request or Response then it probably should NOT go in the container. If a class frequently appears in a list it should probably NOT go in the container.</p>
<p>If an application is full of calls to Resolve<t>() then it was built by someone who doesn&#39;t understand the basic concepts of IOC.</t></p>
<p>Advanced Idiots will combine this with service layers (see number 5). I&#39;ve actually seen IOC containers used to resolve factories that call web services that resolve POCO objects. I&#39;ve actually had an architect that defended this as being good practice. I had to leave work at lunch time before the urge to kill became too great...</p>
<p>#7. CRUD</p>
<p>So many applications start out life as a simple forms-over-data interface. But using CRUD as the basis for an application architecture is doomed from the start. CRUD is built around the data model and non-developers are horrible at thinking about the data model, they really shouldn&#39;t have to.</p>
<p>There is simple crud like active record, but this is about the more advanced CRUD operations. CRUD DAO&#39;s, CRUD Repositories, CRUD View Models, CRUD DTO&#39;s. So much work for such a limited pattern.</p>
<p>The root of this, of course, is the developers innate desire to generalize common patterns and come up with elaborate use of generics to reduce the amount of code we have to write to solve the problem wrong.</p>
<p>Software should be modeled around users and the actions they perform, not rows in a database.</p>
<p>#8. Deployment</p>
<p>The seems to be a rule that the more a company talk about being agile the worse their deployment procedures are. I would argue that being able to deploy frequently (dare I say continuously) is one of the defining features that show your agility as an organization.</p>
<p>If you can not have a bug fix in a customers hands within minutes of bug fixed (excluding testing) then your organization is not agile. Telling users that they have to wait for next months deploy to have a critical issue fixed is not agile. Being unable to put up and tear down test environments on a whim is not agile.</p>
<p>In far to many companies doing a production release is a nerve wracking affair that can consume several days. Number 1, 2 and 5 are the major causes of deployment headaches.</p>
<p>#Conclusion</p>
<p>The cause of every one of these issues has been the same, someone with architect in their title. We really should reconsider what the role of an architect is and if the should be involved with technical decisions, or involved at all.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2014/09/02/2014_07_24_8-Biggest-Mistakes-of-Application-Architecture/" data-id="cir4v5eyx0014ekuy7e7wp3oh" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2014/09/02/2014_07_24_8-Biggest-Mistakes-of-Application-Architecture/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/architecture/">architecture</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014_09_02_Introducing-AAATest" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/02/2014_09_02_Introducing-AAATest/" class="article-date">
  <time datetime="2014-09-01T14:00:00.000Z" itemprop="datePublished">2014-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/02/2014_09_02_Introducing-AAATest/">Introducing AAATest</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I&#39;ve had a bit of time on my hands lately and was determined to finish one of my projects,
or at least make enough progress that I have something to show for it,
something that can be improved upon later.</p>
<p>The project I decided on was a unit test framework.
I had started work on it several months ago but never got much past the exploratory phase.
It was just an experiment to see how far I could push the boundaries of c# and the .net framework,
to see how much could be done in a simpler and more expressive way.</p>
<p>The framework is quickly approaching it&#39;s 0.1 BFW (barely works) milestone
and unlike most of my projects I&#39;m quite pleased with the direction.
So I thought now would be a good time to start writing about it.
Today will be about why it was created and future posts will go into more depth on some design decisions
and experiences as I setup publishing for a new library.</p>
<p>Warning: Some of the comments below might seem like a criticism of nUnit.
My intention isn&#39;t to criticize it but to use it to contrast it with my own effort.
I&#39;ve happily used nUnit for the best part of a decade and will probably use it for many years in future.</p>
<p>#Unit Testing Evolution</p>
<p>Test frameworks have barely evolved over the last decade.
In that time .net community (and Microsoft itself) has changed quite dramatically.
MVC has been embraced as the way to build web apps.
Nuget and the countless OSS tools it provides have been embraced by the community.
Continuous integration and deployment are no longer foreign words.</p>
<p>But our test frameworks are largely the same.
If I had to use a release of nUnit that is ten years old I doubt I would notice.
This isn&#39;t because nUnit is bad, quite the opposite is true.
It just hasn&#39;t changed because it works,
and works wel, we&#39;ve all just learned to accept the warts as just the way things are.</p>
<p>The other part of the problem, I think, is that our test frameworks are general test frameworks.
nUnit works well for pure unit testing and it works well for integration tests.
Being versatile is a good thing,
but many have gone down the wrong path with unit testing based on the lack of direction.</p>
<p>On the other hand, integration testing tools have evolved quite a bit.
There was nothing like SpecFlow a decade ago. Selenium barely worked at the time.
Of course, with the largely static pages of the period there wasn&#39;t as much a need for browser driven testing.</p>
<p>So why did integration testing continue to evolve but unit testing not?
I believe this is because new tools were developed and their focus was
entirely on creating a better experience for integration tests.
In contrast, our tools for unit testing were stuck in there generalist philosophy.</p>
<p>#Narrowing Focus</p>
<p>When I started work on AAATest I wanted to see what would happen if I created a
test framework purely for unit testing.
I was sick of adding arrange, act and assert comments in every single test.
AAATest would be more expressive and have this baked in.</p>
<p>My IOC containers know what dependencies my classes require and work it out just fine at run time.
But my tests, they require me to create the class in every test fixture.
Not just the class but all of it&#39;s dependencies.
AAATest would automatically manage these dependencies.</p>
<p>I wanted it to work with idiomatic code and to push people down the path of writing idiomatic, modern c# code.
It is an opinionated framework, the exact extent of which I don&#39;t know yet.</p>
<p>Presenting <a href="https://github.com/flukus/AAATest.
I could go on, but github has the majority of the content
and is much better than blogger (this blog has since moved to github/hexo" target="_blank" rel="external">AAATest</a> for code samples.
I also put together the <a href="https://github.com/flukus/AAATest/wiki/TDD-Tutorial" target="_blank" rel="external">tutorial on TDD</a> with AAATest.
I&#39;m planning to extend this in future with more examples.
So far it can only run the the tests included in the example test project, but you have to start somewhere.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2014/09/02/2014_09_02_Introducing-AAATest/" data-id="cir4v5eyx001aekuy8vacsoj3" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2014/09/02/2014_09_02_Introducing-AAATest/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AAATest/">AAATest</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unit-test/">unit test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014_09_02_Appveyor-Impressions" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/02/2014_09_02_Appveyor-Impressions/" class="article-date">
  <time datetime="2014-09-01T14:00:00.000Z" itemprop="datePublished">2014-09-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/02/2014_09_02_Appveyor-Impressions/">Appveyor Impressions</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>So I wanted to setup a CI process for AAATest.
I don&#39;t have a server lying around, so I thought I&#39;d give this newfangled cloud CI a try.
Technically I do have a machine lying around that I could use,
but it&#39;s on the other side of the room and I can reach the cloud from here. The cloud CI of choice was <a href="http://www.appveyor.com/" target="_blank" rel="external">Appveyor</a>, which seemed like the most .net compatible one.</p>
<p>#First Impressions</p>
<p>My first impression wasn&#39;t great. My project is setup to use a git submodule for the wiki, which is just how github works. I created a project file to hold the documentation and the main solution references this. Personally I&#39;d prefer the documentation to exist in the same repo, but that is an issue for another day.</p>
<p>The UI build, as far as I could tell, did not allow for subrepositories, so straight away I had to resort to the appveyor build tool, configured via a yaml file in the root of the repository. This is when the problems with appveyor became immediately apparent.</p>
<p>A while ago I wrote about <a href="http://proactivelylazy.blogspot.com.au/2011/06/practical-ms-build-avoiding-spaghetti.html" target="_blank" rel="external">avoiding spaghetti builds</a>. Appveyor violates every one of these rules. I went into detail on the biggest issues below.</p>
<p>##Who&#39;s the Boss?</p>
<p>Even Abed would be confused by this. Does the source contain the build or does the build control the source? It seems to be both. The checkout process goes like this:</p>
<ol>
<li>Appveyor checks out the code.</li>
<li>Appveyor executes the build found in the repository.</li>
<li>The build checks out more code.</li>
</ol>
<p>There is a circular relationship between the source and the build, bound to end in tears. This circular relationship leads to the next issue.</p>
<p>##NoLocal Builds</p>
<p>One of the golden rules of a build system is that it has to be able to run locally. Without this you can&#39;t try a change without committing it. If the build takes several minutes or more (integration tests, deployments, etc) then your downtime between iterations is just as long, not great for productivity.</p>
<p>Imagine if you had to commit your code and wait for a cloud service to compile before seeing any errors. This is essentially what appveyor forces upon your build.</p>
<p>##Build Configuration == Build Process</p>
<p>The other major issue is that there is no real way to configure a build. The configuration is either global or tied to a branch. This limits you to a single build process and there are many good reasons to have more than one.</p>
<p>I generally want to compile and test on every check in, but integration tests take much longer and I&#39;m happy for them to only run as often as possible. I might want performance tests to be compiled in release mode. I might only want the deployment to be run manually, etc.</p>
<p>These scenarios are impossible with the way configuration is handled by Appveyor.</p>
<p>##What is Appveyor</p>
<p>Is it a CI server, competing with team city? Is it a build framework, competing with nant/msbuild? Is it a deployment server, competing with octopus?</p>
<p>Unfortunately the answer seems to be all three. The only good news is that the CI server is what shows the most promise, which is the only part of it I&#39;m interested in using.</p>
<p>#Conclusion</p>
<p>Will it work as a CI server for AAATest? At the moment I think it will, just barely. AAATest is a very simple project, build, test and deploy (nuget) are the only build steps required and I think Appveyor will manage.</p>
<p>For a more complex project, with complex configuration scenarios? I think you would drive yourself mad.
I&#39;m hoping they really focus on the CI server part in future and leave the building and deployment to better tools.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2014/09/02/2014_09_02_Appveyor-Impressions/" data-id="cir4v5eyx0019ekuyh74g6grm" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2014/09/02/2014_09_02_Appveyor-Impressions/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2014_08_19_Android-Take-back-your-builds" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/19/2014_08_19_Android-Take-back-your-builds/" class="article-date">
  <time datetime="2014-08-18T14:00:00.000Z" itemprop="datePublished">2014-08-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/19/2014_08_19_Android-Take-back-your-builds/">Android - Take back your Builds</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>So I started getting back into android development, reviving a little app I published a few years ago. The app itself was fairly crappy by android 1.6 standards (get off my lawn!) and now it&#39;s just looking terrible.</p>
<p>So I fire up the shiny new android studio but it looks like I&#39;m going to have to start the project from scratch and port everything over. After getting frustrated trying to do the simplest things, like adding a library I went back to Eclipse. Several arcane build errors and several even more arcane eclipse ones later I was getting frustrated. Clearly this isn&#39;t going to work.</p>
<p>Aside from the terrible UI&#39;s of both IDE&#39;s there was something much more important. I wasn&#39;t getting any functionality out of them either, they were just getting in my way. I wanted to try the new atom editor but as yet don&#39;t have an invite, so I went back to trusty old vim with ant. This is when I discovered androids dirty little secret: the build system.</p>
<p>##Monolithic Madness</p>
<p>A build system, as with other aspects of development, work best when you start with discreet parts and assemble them into a whole. I expected to find some ant tasks that wrap android tools and to be able to plug them in and get going</p>
<p>Alas, google instead gives us some monolithic tools that define your build system for you. Attempting to go deeper give you a &quot;here be dragons&quot; warning. The tools that are at the very center of android development and yet there documentation consists of:</p>
<blockquote>
<p>The other platform tools, such as aidl, aapt, dexdump, and dx, are typically called by the Android build tools or Android Development Tools (ADT), so you rarely need to invoke these tools directly. As a general rule, you should rely on the build tools or the ADT plugin to call them as needed.</p>
</blockquote>
<p>I firmly believe that this is at the center of why android IDE&#39;s are so lackluster, they have to conform to this monolithic build system. Aside from the &quot;one build to rule them all&quot; approach, building an android app is a very complicated procedure. This isn&#39;t &quot;compile and run&quot; like you find in other types of projects, these are the steps to build a basic, runable android application <a href="http://developer.android.com/tools/building/index.html#detailed-build" target="_blank" rel="external">illustrated here</a></p>
<ul>
<li>Compile layouts, resources, etc into a resource file.</li>
<li>Generate an R.java source file, this is needed just to be able to compile your code.</li>
<li>Compile your real code.</li>
<li>Turn your .class files into .dex files.</li>
<li>Combine your resource file with your .dex files into an .apk.</li>
<li>Sign your .apk.</li>
<li>Finally we get to run!</li>
</ul>
<p>So to create a build system how you want it, you have to replicate all this with little to no documentation. And this is what I&#39;m about to do.</p>
<p>##Step 1 - House Keeping</p>
<p>The first thing we have to do when defining our build is to know where the android sdk, our libraries and everything else is, so in ant we have:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"android.sdk"</span> <span class="attr">location</span>=<span class="string">"D:\Program Files (x86)\Android\android-studio\sdk"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"android.aapt"</span> <span class="attr">location</span>=<span class="string">"$&#123;android.sdk&#125;\build-tools\android-4.4.2\aapt.exe"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"android.jar"</span> <span class="attr">location</span>=<span class="string">"$&#123;android.sdk&#125;\platforms\android-19\android.jar"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"android.dex"</span> <span class="attr">location</span>=<span class="string">"$&#123;android.sdk&#125;\build-tools\android-4.4.2\dx.bat"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"android.adb"</span> <span class="attr">location</span>=<span class="string">"$&#123;android.sdk&#125;\platform-tools\adb.exe"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"build.resource"</span> <span class="attr">location</span>=<span class="string">"build\aapt\resource.jar"</span> /&gt;</span>  </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">record</span> <span class="attr">name</span>=<span class="string">"buildlog.txt"</span> <span class="attr">action</span>=<span class="string">"start"</span> <span class="attr">append</span>=<span class="string">"false"</span> /&gt;</span>  </span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">"libPackage"</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"lib\"</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"android-binding-0.45-update.jar"</span> /&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"guice-2.0-no_aop.jar"</span> /&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"roboguice-1.1.2.jar"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">fileset</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">path</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">"libApp"</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">pathelement</span> <span class="attr">location</span>=<span class="string">"$&#123;android.jar&#125;"</span> /&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">path</span> <span class="attr">refid</span>=<span class="string">"libPackage"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">path</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">path</span> <span class="attr">id</span>=<span class="string">"libTest"</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"lib\"</span>&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"hamcrest-core-1.3.jar"</span> /&gt;</span>  </span><br><span class="line">	<span class="tag">&lt;<span class="name">include</span> <span class="attr">name</span>=<span class="string">"junit-4.11.jar"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">fileset</span>&gt;</span>  </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">pathconvert</span> <span class="attr">property</span>=<span class="string">"info.libPackage"</span> <span class="attr">refid</span>=<span class="string">"libPackage"</span> <span class="attr">pathsep</span>=<span class="string">";&amp;#10;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">pathconvert</span> <span class="attr">property</span>=<span class="string">"info.libApp"</span> <span class="attr">refid</span>=<span class="string">"libApp"</span> <span class="attr">pathsep</span>=<span class="string">";&amp;#10;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">pathconvert</span> <span class="attr">property</span>=<span class="string">"info.libTest"</span> <span class="attr">refid</span>=<span class="string">"libTest"</span> <span class="attr">pathsep</span>=<span class="string">";&amp;#10;"</span> /&gt;</span>  </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"android.sdk: $&#123;android.sdk&#125;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"android.aapt: $&#123;android.aapt&#125;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"android.jar: $&#123;android.jar&#125;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"android.dex: $&#123;android.dex&#125;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"build.resource: $&#123;build.resource&#125;"</span> /&gt;</span>  </span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"libPackage:"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"$&#123;info.libPackage&#125;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"libApp"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"$&#123;info.libApp&#125;"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"libTest"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">echo</span> <span class="attr">message</span>=<span class="string">"$&#123;info.libTest&#125;"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>It might seem a bit verbose but having everything defined here and having the actual values in the output will make debugging a lot simpler. libPackage are the bare minimum of libraries that we need to deploy with our app. libApp is the superset of these that we need to compile, basically libPackage + android.jar. libTest is a superset of that which includes libraries like junit.</p>
<p>Our first two real targets are the clean and init ones:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"clean"</span>&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">dir</span>=<span class="string">"build"</span> /&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span>   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"init"</span>&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">tstamp</span>/&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">"$&#123;build&#125;"</span>/&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">"$&#123;build&#125;\aapt\"</span>/&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">"$&#123;build&#125;\javac\app"</span>/&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">"$&#123;build&#125;\javac\test"</span>/&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">mkdir</span> <span class="attr">dir</span>=<span class="string">"$&#123;build&#125;\dex"</span>/&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>##Step 2: Compiling</p>
<p>Next in line is compiling our project:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"build"</span> <span class="attr">depends</span>=<span class="string">"init"</span> &gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">exec</span> <span class="attr">executable</span>=<span class="string">"$&#123;android.aapt&#125;"</span> <span class="attr">failonerror</span>=<span class="string">"true"</span>&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"package"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-f"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-v"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-M"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">path</span>=<span class="string">"src\app\AndroidManifest.xml"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-A"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">path</span>=<span class="string">"src\app\assets"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-I"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">path</span>=<span class="string">"$&#123;android.jar&#125;"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-m"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-J"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">path</span>=<span class="string">"build\aapt\"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-F"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">path</span>=<span class="string">"$&#123;build.resource&#125;"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"-S"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">path</span>=<span class="string">"src\app\res"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"--rename-manifest-package"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">arg</span> <span class="attr">value</span>=<span class="string">"my.new.package.name"</span> /&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;/<span class="name">exec</span>&gt;</span>   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">javac</span> <span class="attr">destdir</span>=<span class="string">"build\javac\app"</span> <span class="attr">includeantruntime</span>=<span class="string">"false"</span> <span class="attr">classpathref</span>=<span class="string">"libApp"</span> &gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">src</span> <span class="attr">path</span>=<span class="string">"src\app\"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">src</span> <span class="attr">path</span>=<span class="string">"build\aapt\com"</span> /&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;/<span class="name">javac</span>&gt;</span>   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">javac</span> <span class="attr">destdir</span>=<span class="string">"build\javac\test"</span> <span class="attr">includeantruntime</span>=<span class="string">"false"</span> <span class="attr">classpathref</span>=<span class="string">"libTest"</span> &gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">src</span> <span class="attr">path</span>=<span class="string">"src\test\"</span> /&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">classpath</span>&gt;</span>   </span><br><span class="line">			<span class="tag">&lt;<span class="name">pathelement</span> <span class="attr">location</span>=<span class="string">"build\javac\app"</span>/&gt;</span>   </span><br><span class="line">			<span class="tag">&lt;<span class="name">path</span> <span class="attr">refid</span>=<span class="string">"libTest"</span>/&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;/<span class="name">classpath</span>&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;/<span class="name">javac</span>&gt;</span>   </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span>  </span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p>The first and most unfamiliar one is where we invoke the aapt tool. I honestly don&#39;t know what half of these options are because it&#39;s so poorly documented but the important ones are:</p>
<pre><code>-M The location of your android manifest file.
-I The location of the android.jar that your using.
-J The location of the R.java file (needed to compile your real code).
-F The location of the generated resource.jar.
-S The location of your resource files.
</code></pre><p>The first javac compiles our actual application, referencing the libApp libraries. The source files used are src\app (Application code) and build\aapt\com (R.java). The second compiles our unit tests, making sure to add our application .class files to the classpath.</p>
<p>##Step 3: Testing</p>
<p>This is a very generic task that runs our unit tests. For java developers it should look fairly standard, just run junit with our compiled .class files and libTest libraries in the classpath:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">target</span> <span class="attr">name</span>=<span class="string">"test"</span> <span class="attr">depends</span>=<span class="string">"init, build"</span> &gt;</span>   </span><br><span class="line">	<span class="tag">&lt;<span class="name">junit</span> <span class="attr">haltonerror</span>=<span class="string">"true"</span> <span class="attr">haltonfailure</span>=<span class="string">"false"</span> <span class="attr">enableTestListenerEvents</span>=<span class="string">"true"</span>&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">classpath</span> &gt;</span>   </span><br><span class="line">			<span class="tag">&lt;<span class="name">pathelement</span> <span class="attr">location</span>=<span class="string">"build\javac\app"</span>/&gt;</span>   </span><br><span class="line">			<span class="tag">&lt;<span class="name">pathelement</span> <span class="attr">location</span>=<span class="string">"build\javac\test"</span>/&gt;</span>   </span><br><span class="line">			<span class="tag">&lt;<span class="name">path</span> <span class="attr">refid</span>=<span class="string">"libTest"</span>/&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;/<span class="name">classpath</span>&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;<span class="name">batchtest</span>&gt;</span>   </span><br><span class="line">			<span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"build\javac\test"</span> <span class="attr">includes</span>=<span class="string">"**/*.class"</span> /&gt;</span>   </span><br><span class="line">			<span class="tag">&lt;<span class="name">formatter</span> <span class="attr">type</span>=<span class="string">"plain"</span> <span class="attr">usefile</span>=<span class="string">"false"</span>/&gt;</span>   </span><br><span class="line">		<span class="tag">&lt;/<span class="name">batchtest</span>&gt;</span>   </span><br><span class="line">	<span class="tag">&lt;/<span class="name">junit</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>At this point we&#39;ve create our standard &quot;build&quot;. It is completely independent of the IDE. with VI for example, I simply type :mak<enter> and all my tests are run in approximately 4 seconds for fast feedback.</enter></p>
<p>Unfortunately unit tests aren&#39;t enough and we will want to actually run our app. In the next article I&#39;ll cover packaging, signing and deploying. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2014/08/19/2014_08_19_Android-Take-back-your-builds/" data-id="cir4v5eyx0016ekuyor5uvq54" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2014/08/19/2014_08_19_Android-Take-back-your-builds/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2013_12_15_ORM-vs-SQL-3-Filtering" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/12/15/2013_12_15_ORM-vs-SQL-3-Filtering/" class="article-date">
  <time datetime="2013-12-14T13:00:00.000Z" itemprop="datePublished">2013-12-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/12/15/2013_12_15_ORM-vs-SQL-3-Filtering/">ORM vs SQL Part 3 - Filtering</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>The final of the 3 basic scenarios that nearly every application will need is filtering, the where clause in an sql statement. An application will have to display a list of products in a category, filter a list of users by email address, get an order by it&#39;s id or something along those lines. It&#39;s practically impossible to write an application with out it.</p>
<p>The most interesting thing about filtering is that it&#39;s rather simple to write a query that can handle all your scenarios. The problem is that it renders all your carefully planned indexes irrelevant or worse. Sql server can be quite fickle about using indexes, depending on the cardinality, execution plan and phase of the moon. I&#39;ll show just how stupid it can sometimes be.</p>
<p>#Filtering with an ORM</p>
<p>Once again we can build our dynamic query with an ORM quite simply:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var query = Session.QueryOver&lt;User&gt;();</span><br><span class="line">if (string.IsNullOrEmpty(filterId))</span><br><span class="line">  query = query.Where(x =&amp;amp;gt; x.Id == filterId);</span><br><span class="line">if (string.IsNullOrEmpty(filterLastName))</span><br><span class="line">  query = query.Where(Restrictions.On&lt;User&gt;(x =&gt; x.LastName).IsLike(filterLastName));</span><br><span class="line">if (string.IsNullOrEmpty(filterEmail))</span><br><span class="line">  query = query.Where(Restrictions.On&lt;User&gt;(x =&gt; x.Email).IsLike(filterEmail));</span><br><span class="line">var result = query.List();</span><br></pre></td></tr></table></figure>
<p>Once again, our ORM builds a prepared statement for every unique situation which can make use of the appropriate indexes if we have any. It&#39;s not necessarily fast, that will depend on your performance tuning, but it&#39;s as fast as it can be.</p>
<p>#Filtering with Sql</p>
<p>Dynamically filtering with sql is also quite simple. To get the same functionality as above:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> TOP(<span class="number">20</span>) <span class="keyword">id</span>, lastName, firstName, email</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">users</span></span><br><span class="line"><span class="keyword">where</span> <span class="comment">--lastName = '21250A22-6B3F-452C-9FE3-7EBBF216B13C'</span></span><br><span class="line">  (@<span class="keyword">id</span> <span class="keyword">is</span> <span class="literal">null</span> <span class="keyword">OR</span> @<span class="keyword">id</span> = @<span class="keyword">id</span>)</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">  (@lastName <span class="keyword">is</span> <span class="literal">null</span> <span class="keyword">or</span> lastName <span class="keyword">Like</span> @lastName + <span class="string">'%'</span>)</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">  (@email <span class="keyword">is</span> <span class="literal">null</span> <span class="keyword">or</span> email <span class="keyword">LIKE</span> @email + <span class="string">'%'</span>)</span><br></pre></td></tr></table></figure>
<p>This is much more elegant than our solutions in the past two posts. The first problem is, what if you want some other logic, if you want to search by last name or email then this won&#39;t work. You&#39;ll either need something far more elaborate or you&#39;ll need several identical queries. The other problem is that it may not use an index, or even worse, will use the wrong index.</p>
<p>#What index will this use?</p>
<p>Well the answer is it depends on a lot of things. The first query, collected statistics and moon phases being the primary influences. I don&#39;t know about you, but I like my systems to perform consistently. Assuming the above query is in a stored procedure:</p>
<ul>
<li>execute the procedure with @id=null, @lastName=&#39;abc&#39;, @email=null</li>
<li>Query finishes in ~280ms. The index on lastName was used</li>
<li>execute the procedure with @id=null, @lastName=null, @email=&#39;abc&#39;</li>
<li>Query finishes in ~11000ms, still using the index on lastName, not the index on email</li>
<li>execute the procedure with @id=&#39;C15BAFAA-B772-4863-8849-00413B531C29&#39;, @lastName=null, @email=null</li>
<li>Query finishes in ~11000ms, still using the index on lastName, not the primary key index</li>
<li>execute the procedure with @id=null, @lastName=null, @email=null</li>
<li>Query finishes in ~12000ms, still using the index on lastName</li>
</ul>
<p>Deleting our indexes and repeating the queries in the same order takes ~50ms, ~60ms, ~20ms, 20ms.
So a query like this will not only render many of your indexes useless but can cause the wrong index to be used, which is much worse. Again the tailor made query that an ORM will generate will have much better performance than a generic one that you can create.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2013/12/15/2013_12_15_ORM-vs-SQL-3-Filtering/" data-id="cir4v5eyx0012ekuykfdpn0vm" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2013/12/15/2013_12_15_ORM-vs-SQL-3-Filtering/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/orm/">orm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql/">sql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2013_12_12_ORM-vs-SQL-2-Ordering" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/12/12/2013_12_12_ORM-vs-SQL-2-Ordering/" class="article-date">
  <time datetime="2013-12-11T13:00:00.000Z" itemprop="datePublished">2013-12-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/12/12/2013_12_12_ORM-vs-SQL-2-Ordering/">ORM vs SQL Part 2 - Ordering</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Most applications will need to to control the ordering of the data being presented to users, the exact requirements will differ depending on the application and situation, but virtually all will require it. Sometimes the same data will presented in several places, each requiring it&#39;s own order for natural reasons. Other times dynamic tables will be presented and users will control what order the view information in. Some even allow full control and let the users specify multiple orders.</p>
<p>In the later two cases ordering usually goes hand in hand with filtering, but I&#39;m going to leave the filtering until part three. In <a href="ORM-vs-SQL-1---Paging">part one</a> I looked at paging.</p>
<p>#Ordering with an ORM</p>
<p>Simple ordering is straight forward with an ORM (and with sql for that matter):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var users = session.QueryOver&lt;User&gt;()</span><br><span class="line">  .OrderBy(x =&gt; x.LastName).Asc.List();</span><br></pre></td></tr></table></figure>
<p>In fact, at this level, sql is even simpler. An ORM starts to shine when you have some other logic controlling the ordering because you get a composable query object to work with, for example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var query = session.QueryOver&lt;User&gt;();</span><br><span class="line">if (orderByLastName == true)</span><br><span class="line">  query = query.OrderBy(x=&gt; x.LastName).Asc;</span><br><span class="line">if (orderByLastLogin == true)</span><br><span class="line">  query = query.OrderBy(x=&gt; x.LastLogin).Asc;</span><br></pre></td></tr></table></figure>
<p>By composing queries like this, any ordering that can be logically described can be performed, your only limit is your own code and how much power and flexibility you want to give the end users.
The ORM will generate the sql needed for that individual scenario and make full use of our indexes.</p>
<p>#Ordering with Sql</p>
<p>Simple ordering in sql is extremely straight forward:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> TOP <span class="number">10</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">order</span> <span class="keyword">by</span> lastName</span><br></pre></td></tr></table></figure>
<p>Most importantly, this will use the index on lastName. On my computer this will execute in ~5ms with 1,000,000 rows. This is essentially what our ORM will generate.</p>
<p>Now, let&#39;s say our application is showing a list of users in two places, the first we are trying to find users by last name and the second we want to see who were the latest to login. We can write two stored procedures, which will be identical apart from the order by clause. Or we can add some dynamic ordering to the query:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">10</span> <span class="keyword">id</span>, lastName, firstName</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">users</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">CASE</span></span><br><span class="line">  <span class="keyword">WHEN</span> @OrderBy = <span class="string">'LastNameAsc'</span> <span class="keyword">THEN</span> lastName</span><br><span class="line">  <span class="keyword">WHEN</span> @OrderBy = <span class="string">'FirstName'</span> <span class="keyword">THEN</span> firstName</span><br></pre></td></tr></table></figure>
<p>The drawbacks for this are that the data types have to be the same in the case statement, so we can&#39;t use the same query to order by lastLogin. Likewise, we can&#39;t mix ascending and descending. And even if we are ordering on lastName, which has an index in this scenario, the index will not get used, resulting in bad performance, 753ms, which is more than two orders of magnitude slower for the same functionality.</p>
<p>In <a href="ORM-vs-SQL-1---Paging">part one</a> I said the new 2012 offset/next syntax performed quite slowly with dynamic ordering, this is why.</p>
<p>#Ordering with Sql - Again</p>
<p>So being unable to mix datatypes is a deal breaker in our scenario. we want to order by either lastName or lastLogin. The easiest way to do this is to invite our old friend from <a href="ORM-vs-SQL-1---Paging">part one</a>, rownumber:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">10</span> <span class="keyword">id</span>, lastName, firstName,</span><br><span class="line">  <span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> @OrderBy = <span class="string">'LastNameAsc'</span> <span class="keyword">THEN</span> ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> lastName)</span><br><span class="line">    <span class="keyword">WHEN</span> @OrderBy = <span class="string">'LastLoginDesc'</span> <span class="keyword">THEN</span> ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> lastLogin <span class="keyword">desc</span>)</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">as</span> rownumber</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">users</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> rownumber</span><br></pre></td></tr></table></figure>
<p>Finally, we can order by multiple data types and by ascending or descending order. But it comes at a hefty price, it&#39;s yet another order of magnitude slower, ~5800ms, way beyond what I would consider acceptable.</p>
<p>#Ordering and Paging</p>
<p>So now let&#39;s look at the combination of paging and ordering:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP(@take) <span class="keyword">id</span>, lastName, firstName, email, lastLogin</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="keyword">id</span>, lastName, firstName, email, lastLogin,</span><br><span class="line">  <span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> @OrderBy = <span class="string">'LastNameAsc'</span> <span class="keyword">THEN</span> ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> lastName)</span><br><span class="line">    <span class="keyword">WHEN</span> @OrderBy = <span class="string">'LastLoginDesc'</span> <span class="keyword">THEN</span> ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> lastLogin <span class="keyword">desc</span>)</span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">as</span> rownumber</span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">users</span></span><br><span class="line">) <span class="keyword">as</span> <span class="keyword">query</span></span><br><span class="line"><span class="keyword">WHERE</span> query.rownumber &gt; @<span class="keyword">skip</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> rownumber</span><br></pre></td></tr></table></figure>
<p>Our simply little select isn&#39;t so simple any more and the performance has suffered terribly (~8500ms), to the point where it is immediately noticeable to end users. All because you thought ORM&#39;s were too slow.</p>
<p>We are quickly approaching the limits of what we can do with sql. The ORM can easily handle ordering over multiple columns dynamically, to do the same with sql would require a fundamentally different, and probably much more complex, strategy.</p>
<p>#Why are ORM&#39;s faster?</p>
<p>In this scenario our ORM is 3 orders of magnitude faster than a stored procedure with the same functionality. This is simply because it generates queries dynamically, it doesn&#39;t have to account for every possibility at programming time because it can adjust at run time instead.</p>
<p>Sql, despite frequently being championed as faster, can not even make use of indexes appropriately as soon as you throw a real world situation at it.</p>
<p>The final score, with paging and ordering is ORM: ~10ms, Sql: ~8500ms.</p>
<p>Next up, I&#39;ll take a look at <a href="ORM-vs-SQL-3---Filtering">dynamic filtering</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2013/12/12/2013_12_12_ORM-vs-SQL-2-Ordering/" data-id="cir4v5eyh0011ekuyzk80n6u7" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2013/12/12/2013_12_12_ORM-vs-SQL-2-Ordering/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/orm/">orm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql/">sql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2013_09_19_Your-Checkin-Process-is-Ruining-Your-Checkin-Process" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/09/19/2013_09_19_Your-Checkin-Process-is-Ruining-Your-Checkin-Process/" class="article-date">
  <time datetime="2013-09-18T14:00:00.000Z" itemprop="datePublished">2013-09-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/09/19/2013_09_19_Your-Checkin-Process-is-Ruining-Your-Checkin-Process/">Your checkin process is Ruining your checkin process</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Like most people I like to take the easy road, the path of least resistance. Fortunately most of the tools we use on a daily basis cater for that and makes life as easy as possible. One of those tools is source control, every SCM, TFS aside, makes it a straightforward process to checkout, checkin, branch and merge your code.</p>
<p>The requirements of an SCM (not the implimentation) are fairly modest. It has to keep track of our files, when, who and why they have changed. It has to keep a historical record of these changes for that inevitable day when someone ask &quot;WTF was this done for?&quot;. An SCM will take care of the who and when for the most part, we just have to supply the why.</p>
<p>Unless your trying to assign blame the why is the most important part. It&#39;s a little message to future you or future college what the reasoning behind that particular change was. This is one of the most invaluable features of source control.</p>
<p>Then the complicators get in, these guys are just like there architecture astronaut counterparts. The see a simple process and try to make it enterprisy. All of a sudden source control, instead of being the bedrock of the development process, becomes a management tool and prevents good practices instead of creating them.</p>
<p>Here are some common ways too much process can wreck your development bedrock.</p>
<p>#&quot;Every checkin shall hencforth require a ticket&quot; - The Complicator</p>
<p>This is probably the most common form of SCM abuse. Every checkin requires a reference to a task or a bug so that every change is recorded and justified. It sounds like a good idea at the start but it has some pretty serious downsides that aren&#39;t immediately apparent.</p>
<p>Quite frequently we come across bugs and being the good developers we are, we like to fix things, we fix it while we&#39;re there. But then comes the paperwork, the mental overhead that we would rather not deal with. Should we create a bug for this single line fix? Should we role it into another checkin? Should we ignore it?</p>
<p>Creating bug ticket for a single line fix we just happened to come across is just more trouble than it&#39;s worth, we are developers after all, not bureaucrats. The 10 minutes or more to create a ticket for a 5 second fix is woefully inefficient.</p>
<p>Squeezing it in to another checkin is probably the most common result, but it undermines the value of source control and, ironically enough, the process that was put around it. The process that was meant to document the reason for the change suddenly has a random change with no apparent reason, which makes it pretty useless.</p>
<p>This also leads to another problem, monolithic checkins. A monolithic checkin is either more than a days work in a single checkin or several unrelated changes in a single checkin. The bigger the checkin the less likely it is that all the changes have been documented correctly. And the bigger the checkin the harder merging will be. So in this case too much checkin has undermined the value of source control.</p>
<p>#The Inevitable Result</p>
<p>The final option left to the developer and probably the most common one is to ignore the problem in the first place. As I said, I follow the path of least resistance, and if your process requires more work than fixing a bug then we might just decide it&#39;s not worth while. Every body loses in this situation, the business has a worse product and the developers don&#39;t get to fix things. We like fixing things.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2013/09/19/2013_09_19_Your-Checkin-Process-is-Ruining-Your-Checkin-Process/" data-id="cir4v5eyh000xekuyfwmvatfw" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2013/09/19/2013_09_19_Your-Checkin-Process-is-Ruining-Your-Checkin-Process/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scm/">scm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2013_03_31_NServicebus-Configuration-is-a-Nightmare" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/03/31/2013_03_31_NServicebus-Configuration-is-a-Nightmare/" class="article-date">
  <time datetime="2013-03-30T13:00:00.000Z" itemprop="datePublished">2013-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/03/31/2013_03_31_NServicebus-Configuration-is-a-Nightmare/">NServicebus Configuration is a Nightmare</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>So I&#39;m pulling my hair out at the moment trying to configure nServiceBus. I&#39;ve spent a couple of days trying to get something working to no avail. The core issues seem to be the configuration and lack of documentation. My current trial and error approach is getting me nowhere.</p>
<p>I don&#39;t think it&#39;s too much to ask that a trivial pub/sub queue should be able to be setup in minutes, even if it&#39;s all in memory. I just want to be able to get on developing the application itself and to come back update the configuration later to something more robust.</p>
<p>The following rant may be completely wrong, but the documentation didn&#39;t exactly steer me in the right direction.</p>
<p>#Why is the configuration so bad?</p>
<p>The main reason is because there is no single way to configure nServiceBus. The configuration is handled four different ways, the web/app config file, the fluent configuration, the declarative configuration and the &quot;convention&quot;.</p>
<p>The application config method seems to be the outdated way to configure nServiceBus. Except for all those times and exception is thrown because of a missing config section. This leads you to adding config sections without knowing what they actually are, just to shut up the exception. I know this is my fault for adding stuff without realizing what it is, but I&#39;m sure I&#39;m not the only person to have done it.</p>
<p>I love the idea of fluent configuration, but the current implementation is lacking. Adding .MsmqTransport at application start up seems pretty simple right? But then you get random exceptions because of missing elements in the web.config. I think if your going to have a fluent API then it should be completely self contained, not half and half.</p>
<p>The declarative configuration seems to only be if you are running the nServiceBus process host, but this wasn&#39;t entirely clear from the documentation. It basically involves creating a class with a marker interface and for this class to contain the configuration information. For my current project needs to be hosted in my own executable (to satisfy app harbor), but I&#39;m not entirely sure if I need it or not.</p>
<p>Conventions are also used throughout nServiceBus, but it&#39;s not always clear what those conventions are.</p>
<p>#And the Documentation?</p>
<p>The documentation isn&#39;t bad and there is quite a bit of it but some more step by step tutorials would be good. There is absolutely no documentation on how to configure nServiceBus to use ravendb, which is quite frustrating, because that&#39;s what I&#39;m trying to use.</p>
<p>None of the documentation seems to tell you which version it was created with, so I never have any idea if what I&#39;m reading is relevant or not.</p>
<p>The latest version of the tutorials is also completely useless as it uses the WYSIWYG editor, which for some reason won&#39;t install in my version of visual studio. Not that I want to use it anyway, I prefer the code first approach, for which there is no up to date documentation.</p>
<p>#What I&#39;d like?</p>
<p>I would love an entirely self contained fluent configuration that made it clear what was happening, something like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Configure.AsPublisher(x =&gt; &#123; x.Queue = myRavenQueue &#125;)</span><br><span class="line">Configure.AsSubscriber(x=&gt; &#123; x.Queue = myRavenQueue &#125;)</span><br></pre></td></tr></table></figure>
<p>Making it clear what is happening is important, because the current configuration options absolute do not.</p>
<p>For now I&#39;m not sure what to do. Continue persevering? Hard to do when I have no idea if I&#39;m getting closer or not. Look for alternatives? Maybe. Rhino service bus is nicer but I&#39;m not sure of the future of the project. Avoid it all together? I don&#39;t particularly need a service bus right now, but less code, future scalability and built in fault tolerance are all pushing me towards one.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2013/03/31/2013_03_31_NServicebus-Configuration-is-a-Nightmare/" data-id="cir4v5eyh000uekuyu8f3b7kn" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2013/03/31/2013_03_31_NServicebus-Configuration-is-a-Nightmare/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nServiceBus/">nServiceBus</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2013_01_27_App-Harbor-Security-and-Configuration" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/01/27/2013_01_27_App-Harbor-Security-and-Configuration/" class="article-date">
  <time datetime="2013-01-26T13:00:00.000Z" itemprop="datePublished">2013-01-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/27/2013_01_27_App-Harbor-Security-and-Configuration/">App Harbor, Security and Configuration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>By now we&#39;ve all read the story about <a href="http://it.slashdot.org/story/13/01/25/132203/github-kills-search-after-hundreds-of-private-keys-exposed" target="_blank" rel="external">keys and passwords</a> being kept in source control. It seems pretty obvious it&#39;s a bad idea but it tends to be our tools that force us down this path. At the moment this is being forced on me by app harbor and it&#39;s deployment model.</p>
<p>App Harbor deployment works by taking a web.config and applying the transformations in web.release.config. The problem with this is that all you configuration must be under source control, and everyone that works on the source has access to private security information.</p>
<p>#Web.Config</p>
<p>As a general rule, I don&#39;t like to keep the Web.config file in source control at all and generally write an ignore rule for it. Having it in source control virtual guarantees that at some point someone will put private information in there accidentally. Nothing is more frustrating than pulling the latest version of the source and having someone overwrite all your settings.</p>
<p>With a traditional CI server setup I would have a config template and would generate a full Web.config based on settings in the CI server but App Harbor is very limited support for this style. This is a nice compromise, it&#39;s easy to setup a configuration for a new user or server and it keeps everyone from overwriting each others configuration files.</p>
<p>App Harbor however, forces you to have a Web.config file in source control. Forcing you to be just one blonde moment away from committing private information.</p>
<p>#Configuration Variables</p>
<p>App Harbor provides half a solution, it allows you to set configuration variables in the application manager interface. While this is okay for some simple key value settings, sometimes the configuration is more complex. Here is an example of a configuration section using the <a href="https://github.com/titarenko/OAuth2" target="_blank" rel="external">OAuth2</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Source ommited becausee it was too messy to clean up</span><br></pre></td></tr></table></figure>
<p>The only way to get such a configuration into App Harbor is to have it in a config file under source control, giving everyone access to private information.</p>
<p>#What I&#39;d Like</p>
<p>What I&#39;d really like is rather simple. I want to store a config file in the application manager interface that will be copied into the project as part of the build. This way no configuration has to be under source control, no private information shared and simplicity remains.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2013/01/27/2013_01_27_App-Harbor-Security-and-Configuration/" data-id="cir4v5ey1000tekuyeqqqqnl0" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2013/01/27/2013_01_27_App-Harbor-Security-and-Configuration/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/app-harbor/">app harbor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-2013_01_25_How-to-turn-away-paying-customers" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/01/25/2013_01_25_How-to-turn-away-paying-customers/" class="article-date">
  <time datetime="2013-01-24T13:00:00.000Z" itemprop="datePublished">2013-01-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/25/2013_01_25_How-to-turn-away-paying-customers/">How to turn away paying customers</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I have a couple of recent examples of companies being unwilling to take my money.</p>
<p>The first is Amazon. I was working on an app and thought amazon S3 would be perfect for blob storage. After going through the most annoying, buggy sign up experience possible I was informed that Amazon, the worlds largest online retailer, is unable to process a card with a CCV.</p>
<p>The solution: Rackspace Cloudfiles. Which was actually closer to what I was looking for anyway.</p>
<p>The next one was nDepend. I&#39;ve wanted this for a while and used the trial at a number of places. I finally decided to cough up and buy a legit copy. The only thing standing in my way is there reluctance to accept gmail accounts. Sorry guys, web mail is ubiquitous and you better get used to it, until then I&#39;ll just go without.</p>
<p>Update: As you might have seen in the comments, nDepend has some very pro active support and have enabled purchases with gmail addresses. So, I&#39;m now a proud owner. Fortunately the current project only has one major issue but there are some others where I know nDepend will help out a lot.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2013/01/25/2013_01_25_How-to-turn-away-paying-customers/" data-id="cir4v5ey1000sekuy8fdznb0i" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2013/01/25/2013_01_25_How-to-turn-away-paying-customers/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/general/">general</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AAATest/">AAATest</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app-harbor/">app harbor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/">architecture</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build/">build</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c#</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/general/">general</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/general-programming/">general programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/integration-test/">integration test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/msbuild/">msbuild</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nServiceBus/">nServiceBus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nant/">nant</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nunit/">nunit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/one/">one</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orm/">orm</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/powershell/">powershell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/psake/">psake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scm/">scm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unit-test/">unit test</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AAATest/" style="font-size: 12.5px;">AAATest</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/app-harbor/" style="font-size: 10px;">app harbor</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/build/" style="font-size: 20px;">build</a> <a href="/tags/c/" style="font-size: 17.5px;">c#</a> <a href="/tags/general/" style="font-size: 10px;">general</a> <a href="/tags/general-programming/" style="font-size: 10px;">general programming</a> <a href="/tags/integration-test/" style="font-size: 10px;">integration test</a> <a href="/tags/msbuild/" style="font-size: 15px;">msbuild</a> <a href="/tags/nServiceBus/" style="font-size: 10px;">nServiceBus</a> <a href="/tags/nant/" style="font-size: 12.5px;">nant</a> <a href="/tags/nunit/" style="font-size: 10px;">nunit</a> <a href="/tags/one/" style="font-size: 10px;">one</a> <a href="/tags/orm/" style="font-size: 15px;">orm</a> <a href="/tags/powershell/" style="font-size: 12.5px;">powershell</a> <a href="/tags/psake/" style="font-size: 10px;">psake</a> <a href="/tags/scm/" style="font-size: 10px;">scm</a> <a href="/tags/sql/" style="font-size: 17.5px;">sql</a> <a href="/tags/unit-test/" style="font-size: 15px;">unit test</a> <a href="/tags/vim/" style="font-size: 12.5px;">vim</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">August 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/07/27/2016_07_27_Creating-a-Windows-Service/">Creating a Windows Service</a>
          </li>
        
          <li>
            <a href="/2016/04/15/2016_04_15_Background-Builds-with-Vim-8/">Background Builds with Vim 8</a>
          </li>
        
          <li>
            <a href="/2015/08/12/2013_12_10_ORM-vs-SQL-1-Paging/">ORM vs SQL Part 1 - Paging</a>
          </li>
        
          <li>
            <a href="/2015/07/24/2015_07_24_Simple-Abstractions/">Simple Abstractions</a>
          </li>
        
          <li>
            <a href="/2015/07/09/2015_07_09-Interfaces-for-Data/">Simple Interfaces for Data</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Luke Usher<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'proactivelylazy';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>