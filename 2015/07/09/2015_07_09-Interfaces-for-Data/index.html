<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Simple Interfaces for Data | Proactively Lazy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Interfaces seem to be a feature that is both under used and over used.
Typically they get over used for everything that will have unit tests and dependency injection.
There are plenty of arguments aga">
<meta property="og:type" content="article">
<meta property="og:title" content="Simple Interfaces for Data">
<meta property="og:url" content="http://flukus.github.io/2015/07/09/2015_07_09-Interfaces-for-Data/index.html">
<meta property="og:site_name" content="Proactively Lazy">
<meta property="og:description" content="Interfaces seem to be a feature that is both under used and over used.
Typically they get over used for everything that will have unit tests and dependency injection.
There are plenty of arguments aga">
<meta property="og:updated_time" content="2015-08-11T23:38:44.922Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Simple Interfaces for Data">
<meta name="twitter:description" content="Interfaces seem to be a feature that is both under used and over used.
Typically they get over used for everything that will have unit tests and dependency injection.
There are plenty of arguments aga">
  
    <link rel="alternative" href="/atom.xml" title="Proactively Lazy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Proactively Lazy</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://flukus.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2015_07_09-Interfaces-for-Data" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/09/2015_07_09-Interfaces-for-Data/" class="article-date">
  <time datetime="2015-07-08T14:00:00.000Z" itemprop="datePublished">2015-07-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Simple Interfaces for Data
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Interfaces seem to be a feature that is both under used and over used.
Typically they get over used for everything that will have unit tests and dependency injection.
There are plenty of arguments against adding unnecessary interfaces like this,
but that is not the case I&#39;m trying to make today.</p>
<p>Instead I won&#39;t to show some uses for interfaces that have nothing to do with architecture,
that will never see an IOC container or unit test but will still have an impact on readability
maintainability and performance.</p>
<p>##INameValuePair</p>
<p>Name value pairs are extremely common, just about every select list,
radio box, check box, etc. relies on one, either explicitly or implicitly.
Just today though, I came across some code that used reflection to get those values.
Other times I&#39;ve seen forced inheritance hierarchies for the same result.
A much simpler alternative is to use an interface:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface INameValuePair &#123;</span><br><span class="line">  public int Id &#123; get; &#125;</span><br><span class="line">  public string Name &#123; get; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This all there is to it, no need for reflection and attributes,
just a simple interface. A couple of examples:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Country : INameValuePair &#123;</span><br><span class="line">  public int Id &#123; get; set; &#125;</span><br><span class="line">  public string Name &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ProductCategory : INameValuePair, IBelongToTenant &#123;</span><br><span class="line">  public int Id &#123; get; set; &#125;</span><br><span class="line">  public string CategoryName &#123; get; set; &#125;</span><br><span class="line">  public string INameValuePair.Name &#123; get &#123; return CategoryName; &#125; &#125;</span><br><span class="line">  pulic int TenantId &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Even this simple example demonstrates a few things.
The first is that, while using inheritance would achieve he same result,
it is a forced relationship.
Just because a country and a product category have two properties in common,
an Id and a name,  doesn&#39;t mean they are related in any way.</p>
<p>The ProductCategory also has two two interfaces.
When you start creating interfaces like this a class will quite often fit into more than one.
Trying to fit this into some sort of inheritance hierarchy will only make things more complicated
and harder to adapt in future.</p>
<p>The final benefit over inheritance is that the interface doesn&#39;t have to be a named match.
If ProductCategory was inheriting from a base class, it would always have a name property.
This means that the you&#39;ve run into a situation where the view is forcing it&#39;s constraints up the stack,
which is never a good situation to be in.</p>
<p>With an explicitly defined interface we don&#39;t have to care about what the method is called,
only that the interface is implemented.</p>
<p>##IBelongToTenant</p>
<p>Multi tenant applications are very common, and the implementation seeps into the data.
Things have to belong to a tenant, otherwise the data is global.
Another very simple interface:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface IBelongToTenant &#123;</span><br><span class="line">  public int TenantId &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ProductCategory : IBelongToTenant &#123;</span><br><span class="line">  public int Id &#123; get; set; &#125;</span><br><span class="line">  public string Name &#123; get; set; &#125;</span><br><span class="line">  pulic int TenantId &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Once this information encoded into the class through an interface some clever things can be done.
Here is an extension method that will filter for the current tenant:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static class TenantExtensions &#123;</span><br><span class="line">  public static IQueryable&lt;T&gt; FilterTenant&lt;T&gt;(this IQueryOver&lt;T&gt; query) where T : IBelongToTenant &#123;</span><br><span class="line">    query = query.Where(x =&gt; x.TenantId == CurrentTenantId);</span><br><span class="line">    return query;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Querying a list of ProductCategory would then look like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var pc = ISession.Query&lt;ProductCategory&gt;()</span><br><span class="line">            .FilterTenant()</span><br><span class="line">            .ToList();</span><br></pre></td></tr></table></figure>
<p>It doesn&#39;t save a lot of code, but it does make it more clear.
A common request I see is for some sort multi tiered tenanting,
where the behavior has to match the corporate structure (don&#39;t ask me why, I just have to implement it).
When the logic is encapsulated like this there is only one place to change
for it to be globally applied.</p>
<p>It also leaves a lot of room for automagic code.
A global query filter could be applied to any query on an IBelongToTenant class for instance,
the method would not need to be called at all.</p>
<p>##ITaggable</p>
<p>The final common item is a tagging system.
A BlogPost and a BlogComment might have tags for instance,
but again, this doesn&#39;t mean they should share a base class.
Our logic can still be encapsulated though:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class Tag &#123;</span><br><span class="line">  public int Id &#123; get; set; &#125;</span><br><span class="line">  public string Name &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface ITaggable &#123;</span><br><span class="line">  public List&lt;Tag&gt; Tags &#123; get; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class BlogPost : ITaggable &#123;</span><br><span class="line">  public int Id &#123; get; set; &#125;</span><br><span class="line">  public string Content &#123; get; set; &#125;</span><br><span class="line">  public List&lt;Tag&gt; Tags &#123; get; set; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Similar to the IBelongToTenant extension method but more complex:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static class TaggableExtensions &#123;</span><br><span class="line">  public static IQueryable&lt;T&gt; FilterTags&lt;T&gt;(this IQueryOver&lt;T&gt; query, IEnumerable&lt;string&gt; tags) where T : ITaggable &#123;</span><br><span class="line">    foreach (var tag in tags)</span><br><span class="line">      query = query.Where(x =&gt; x.Tags.Contains(y =&gt; y.Name == tag));</span><br><span class="line">    return query;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Again the code is more readable:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var pc = ISession.Query&lt;ProductCategory&gt;()</span><br><span class="line">            .FilterTags(queryModel.Tags)</span><br><span class="line">            .ToList();</span><br></pre></td></tr></table></figure>
<p>In this case there are some likely performance optimizations too,
but optimizing the extension method will optimize all ITaggable queries.</p>
<p>##Nothing Amazing</p>
<p>None of these examples are particularly fancy or noteworthy,
just some simple ideas to make code readable and maintainable.</p>
<p>Yet time and again I see much more complicated solutions to achieve the same results.
Developers need to get over our habit trying to fit everything into a hierarchal model.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2015/07/09/2015_07_09-Interfaces-for-Data/" data-id="cin15h1er001nz4uy3yrt36cz" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2015/07/09/2015_07_09-Interfaces-for-Data/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/architecture/">architecture</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/">c#</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/07/24/2015_07_24_Simple-Abstractions/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Simple Abstractions
        
      </div>
    </a>
  
  
    <a href="/2015/07/03/2015_07_03-Vim-errorformat-Demystified/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Vim errorformat Demystified</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AAATest/">AAATest</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app-harbor/">app harbor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/">architecture</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build/">build</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c#</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/general/">general</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/general-programming/">general programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/integration-test/">integration test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/msbuild/">msbuild</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nServiceBus/">nServiceBus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nant/">nant</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nunit/">nunit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orm/">orm</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/powershell/">powershell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/psake/">psake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scm/">scm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unit-test/">unit test</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AAATest/" style="font-size: 12.5px;">AAATest</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/app-harbor/" style="font-size: 10px;">app harbor</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/build/" style="font-size: 20px;">build</a> <a href="/tags/c/" style="font-size: 15px;">c#</a> <a href="/tags/general/" style="font-size: 10px;">general</a> <a href="/tags/general-programming/" style="font-size: 10px;">general programming</a> <a href="/tags/integration-test/" style="font-size: 10px;">integration test</a> <a href="/tags/msbuild/" style="font-size: 15px;">msbuild</a> <a href="/tags/nServiceBus/" style="font-size: 10px;">nServiceBus</a> <a href="/tags/nant/" style="font-size: 12.5px;">nant</a> <a href="/tags/nunit/" style="font-size: 10px;">nunit</a> <a href="/tags/orm/" style="font-size: 15px;">orm</a> <a href="/tags/powershell/" style="font-size: 12.5px;">powershell</a> <a href="/tags/psake/" style="font-size: 10px;">psake</a> <a href="/tags/scm/" style="font-size: 10px;">scm</a> <a href="/tags/sql/" style="font-size: 17.5px;">sql</a> <a href="/tags/unit-test/" style="font-size: 15px;">unit test</a> <a href="/tags/vim/" style="font-size: 12.5px;">vim</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">August 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/15/2016_04_15_Background-Builds-with-Vim-8/">Background Builds with Vim 8</a>
          </li>
        
          <li>
            <a href="/2015/08/12/2013_12_10_ORM-vs-SQL-1-Paging/">ORM vs SQL Part 1 - Paging</a>
          </li>
        
          <li>
            <a href="/2015/07/24/2015_07_24_Simple-Abstractions/">Simple Abstractions</a>
          </li>
        
          <li>
            <a href="/2015/07/09/2015_07_09-Interfaces-for-Data/">Simple Interfaces for Data</a>
          </li>
        
          <li>
            <a href="/2015/07/03/2015_07_03-Vim-errorformat-Demystified/">Vim errorformat Demystified</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Luke Usher<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'proactivelylazy';
  
  var disqus_url = 'http://flukus.github.io/2015/07/09/2015_07_09-Interfaces-for-Data/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>