<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Powershell is a Joke | Proactively Lazy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Powershell is a joke, at least as far as build systems are concerned.
The concepts behind it sound great,
it&amp;#39;s billed as the one true scripting language for everything windows,
but it falls flat o">
<meta property="og:type" content="article">
<meta property="og:title" content="Powershell is a Joke">
<meta property="og:url" content="http://flukus.github.io/2015/03/13/2015_03_13_Powershell-is-a-Joke/index.html">
<meta property="og:site_name" content="Proactively Lazy">
<meta property="og:description" content="Powershell is a joke, at least as far as build systems are concerned.
The concepts behind it sound great,
it&amp;#39;s billed as the one true scripting language for everything windows,
but it falls flat o">
<meta property="og:updated_time" content="2015-08-11T23:38:44.910Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Powershell is a Joke">
<meta name="twitter:description" content="Powershell is a joke, at least as far as build systems are concerned.
The concepts behind it sound great,
it&amp;#39;s billed as the one true scripting language for everything windows,
but it falls flat o">
  
    <link rel="alternative" href="/atom.xml" title="Proactively Lazy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Proactively Lazy</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://flukus.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2015_03_13_Powershell-is-a-Joke" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/13/2015_03_13_Powershell-is-a-Joke/" class="article-date">
  <time datetime="2015-03-12T13:00:00.000Z" itemprop="datePublished">2015-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Powershell is a Joke
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Powershell is a joke, at least as far as build systems are concerned.
The concepts behind it sound great,
it&#39;s billed as the one true scripting language for everything windows,
but it falls flat on it&#39;s face in the real world.</p>
<p>I&#39;ve spent a couple of days trying to setup a rather simple build.
The requirements for this build are about as simple as you could hope for,
compile the app, prepare the deployment, twiddle the web config
and finish with an xcopy deploy.</p>
<p>Should be simple right? The following is a chronicle of my exasperation,
with the occasional nant snippet for comparison.</p>
<p>#Clean and Init</p>
<p>Managing the build directory is the &quot;hello world&quot; of creating a build.
Just creating the build directory lead to the first gotcha:</p>
<pre><code>New-Item .\build -type directory
</code></pre><p>This works fine the first time, but subsequent builds will fail because the directory exists.
The force parameter is needed:</p>
<pre><code>New-Item .\build -type directory -force
</code></pre><p>Apparently you have to <em>force</em> powershell to <em>not</em> create a new directory.
When I create a directory, I just want to make sure it&#39;s there.
Failing on an existing directory is not a sensible default.
How does nant do it:</p>
<pre><code>&lt;mkdir dir=&quot;build&quot; /&gt;
</code></pre><p>Much less cryptic.
Let&#39;s move onto clean, surely an advanced scripting language can delete a directory right?</p>
<pre><code>Remove-Item -path .\build\
</code></pre><p>Nope this prompts the user, exactly the sort of interactivity I don&#39;t want.
I have to tell it to delete all the files first:</p>
<pre><code>Remove-Item -path .\build\  -Include * -Recurse
</code></pre><p>This is the best we can do and it still has a few caveats.
It will fail if the directory doesn&#39;t exist.
It will also fail if explorer is open in one of the directories.
It will fail the first time anyway, it will delete all files and leave the directories.
The second time it will work, the third time it will fail because the directory is missing.
Not the sort of consistency you want in your build system.
How does nant do it?</p>
<pre><code>&lt;delete dir=&quot;build&quot; /&gt;
</code></pre><p>Always works, doesn&#39;t fail if the directory is missing.</p>
<p>#Copying Files</p>
<p>So it&#39;s not great at directories,
how does it handle the next common task, copying files?</p>
<pre><code>Copy-Item .\Rtg.AssetManagement.Web\* .\build\web -recurse -force
</code></pre><p>So far so good,
though defaulting to recursing and overwriting existing files would make more sense in a build system.
What if I only want to exclude .html files?</p>
<pre><code>Copy-Item .\src\* .\build\ -recurse -force -Include &quot;.html&quot;
</code></pre><p>Kind of, it only copies .html files in the base directory.
Likewise, exclude will only filter on the base directory:</p>
<pre><code>Copy-Item .\src\* .\build\ -recurse -force -Exclude &quot;.html&quot;
</code></pre><p>Anything &quot;advanced&quot; requires getting a bit complicated (not my code, one I found online):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$exclude = @(&quot;main.js&quot;)</span><br><span class="line">$excludeMatch = @(&quot;app1&quot;, &quot;app2&quot;, &quot;app3&quot;)</span><br><span class="line">[regex] $excludeMatchRegEx = ‘(?i)‘ + (($excludeMatch |foreach &#123;[regex]::escape($_)&#125;) –join “|”) + ‘’</span><br><span class="line">Get-ChildItem -Path $from -Recurse -Exclude $exclude |</span><br><span class="line">  where &#123; $excludeMatch -eq $null -or $_.FullName.Replace($from, &quot;&quot;) -notmatch $excludeMatchRegEx&#125; |</span><br><span class="line">      Copy-Item -Destination &#123;</span><br><span class="line">          if ($_.PSIsContainer) &#123;</span><br><span class="line">            Join-Path $to $_.Parent.FullName.Substring($from.length)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            Join-Path $to $_.FullName.Substring($from.length)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; -Force -Exclude $exclude</span><br></pre></td></tr></table></figure>
<p>Quite frankly, I don&#39;t understand powershell enough to tell you what this is doing.
It is extremely obfuscated though, especially compared to the nant equivalent:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;copy todir=&quot;build&quot;&gt;</span><br><span class="line">  &lt;fileset basedir=&quot;src&quot;&gt;</span><br><span class="line">    &lt;include name=&quot;*.html&quot; /&gt;</span><br><span class="line">  &lt;/fileset&gt;</span><br><span class="line">&lt;/copy&gt;</span><br></pre></td></tr></table></figure>
<p>The real kicker is that the complexity of the nant script stays relatively flat as well,
multiple base directories, complicated include/exclude functionality,
It all stays simple and understandable.
The powershell equivalent quickly ramps up in complexity.</p>
<p>#Not Built for Purpose</p>
<p>Is powershell a dud? For build purposes I would say yes.
It&#39;s overly complicated, even for simple tasks,
and the default behavior just does not do what I want.
Compared to nant it is downright cryptic.</p>
<p>I can see it&#39;s usefulness, I can see why the defaults are the way they are.
I can see how sys admins might make good use of it.
I can see how exposing powershell endpoints to my apps could make administration easier.</p>
<p>It is terrible for building software though.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://flukus.github.io/2015/03/13/2015_03_13_Powershell-is-a-Joke/" data-id="cin15h1eb001ez4uyb0hatngx" class="article-share-link">Share</a>
      
        <a href="http://flukus.github.io/2015/03/13/2015_03_13_Powershell-is-a-Joke/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/build/">build</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nant/">nant</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/powershell/">powershell</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/03/14/2015_03_14_Strict-Typing-is-More-Dynamic/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Strict Typing is More Dynamic
        
      </div>
    </a>
  
  
    <a href="/2015/03/12/2015_03_12_PSake-First-Impressions/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">PSake First Impressions</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AAATest/">AAATest</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/app-harbor/">app harbor</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/architecture/">architecture</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/build/">build</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/">c#</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/general/">general</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/general-programming/">general programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/integration-test/">integration test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/msbuild/">msbuild</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nServiceBus/">nServiceBus</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nant/">nant</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nunit/">nunit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/orm/">orm</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/powershell/">powershell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/psake/">psake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scm/">scm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/">sql</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unit-test/">unit test</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AAATest/" style="font-size: 12.5px;">AAATest</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/app-harbor/" style="font-size: 10px;">app harbor</a> <a href="/tags/architecture/" style="font-size: 15px;">architecture</a> <a href="/tags/build/" style="font-size: 20px;">build</a> <a href="/tags/c/" style="font-size: 15px;">c#</a> <a href="/tags/general/" style="font-size: 10px;">general</a> <a href="/tags/general-programming/" style="font-size: 10px;">general programming</a> <a href="/tags/integration-test/" style="font-size: 10px;">integration test</a> <a href="/tags/msbuild/" style="font-size: 15px;">msbuild</a> <a href="/tags/nServiceBus/" style="font-size: 10px;">nServiceBus</a> <a href="/tags/nant/" style="font-size: 12.5px;">nant</a> <a href="/tags/nunit/" style="font-size: 10px;">nunit</a> <a href="/tags/orm/" style="font-size: 15px;">orm</a> <a href="/tags/powershell/" style="font-size: 12.5px;">powershell</a> <a href="/tags/psake/" style="font-size: 10px;">psake</a> <a href="/tags/scm/" style="font-size: 10px;">scm</a> <a href="/tags/sql/" style="font-size: 17.5px;">sql</a> <a href="/tags/unit-test/" style="font-size: 15px;">unit test</a> <a href="/tags/vim/" style="font-size: 12.5px;">vim</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">August 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/15/2016_04_15_Background-Builds-with-Vim-8/">Background Builds with Vim 8</a>
          </li>
        
          <li>
            <a href="/2015/08/12/2013_12_10_ORM-vs-SQL-1-Paging/">ORM vs SQL Part 1 - Paging</a>
          </li>
        
          <li>
            <a href="/2015/07/24/2015_07_24_Simple-Abstractions/">Simple Abstractions</a>
          </li>
        
          <li>
            <a href="/2015/07/09/2015_07_09-Interfaces-for-Data/">Simple Interfaces for Data</a>
          </li>
        
          <li>
            <a href="/2015/07/03/2015_07_03-Vim-errorformat-Demystified/">Vim errorformat Demystified</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Luke Usher<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'proactivelylazy';
  
  var disqus_url = 'http://flukus.github.io/2015/03/13/2015_03_13_Powershell-is-a-Joke/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>